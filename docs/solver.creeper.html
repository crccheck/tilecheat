<!DOCTYPE html>  <html> <head>   <title>solver.creeper.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="helpers.html">                 helpers.coffee               </a>                                           <a class="source" href="script.html">                 script.coffee               </a>                                           <a class="source" href="solver.creeper.html">                 solver.creeper.coffee               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               solver.creeper.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p>attempt 2.</p>

<p>This solver find the best possible matching pair, and then finds the the next
tile that best matches an already placed tile until it runs out of tiles.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre><span class="nv">getResult2 = </span><span class="nf">(tiles)-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>Build map of every edge distance possible.</p>

<p>I think this is O(4n^2!), which doesn't sound very efficient, but a 16x16
grid only makes 480 entries. There will be 4 * C(n^2, 2) entries, so 10
slices per side will make 4950 entries. Keys are
<code>&lt;tile&gt;&lt;orientation&gt;&lt;tile&gt;</code>, where orientation is (v)ertical or
(h)orizontal. If this were a typed language, I could probably save some
memory and eke out some performance by making distance an integer.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">delay = </span><span class="nx">_options</span><span class="p">.</span><span class="nx">draw_delay</span>
  <span class="nv">buildMap = </span><span class="o">-&gt;</span>
    <span class="nv">map = </span><span class="p">{}</span>
    <span class="k">for</span> <span class="nx">tile1</span><span class="p">,</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">tiles</span>
      <span class="k">for</span> <span class="nx">tile2</span> <span class="k">in</span> <span class="nx">tiles</span><span class="p">[(</span><span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)..]</span>
        <span class="nx">map</span><span class="p">[</span><span class="s">&quot;</span><span class="si">#{</span><span class="nx">tile1</span><span class="p">.</span><span class="nx">id</span><span class="si">}</span><span class="s">h</span><span class="si">#{</span><span class="nx">tile2</span><span class="p">.</span><span class="nx">id</span><span class="si">}</span><span class="s">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">distance</span><span class="p">(</span><span class="nx">tile1</span><span class="p">.</span><span class="nx">w</span><span class="p">,</span> <span class="nx">tile2</span><span class="p">.</span><span class="nx">e</span><span class="p">)</span>
        <span class="nx">map</span><span class="p">[</span><span class="s">&quot;</span><span class="si">#{</span><span class="nx">tile2</span><span class="p">.</span><span class="nx">id</span><span class="si">}</span><span class="s">h</span><span class="si">#{</span><span class="nx">tile1</span><span class="p">.</span><span class="nx">id</span><span class="si">}</span><span class="s">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">distance</span><span class="p">(</span><span class="nx">tile2</span><span class="p">.</span><span class="nx">w</span><span class="p">,</span> <span class="nx">tile1</span><span class="p">.</span><span class="nx">e</span><span class="p">)</span>
        <span class="nx">map</span><span class="p">[</span><span class="s">&quot;</span><span class="si">#{</span><span class="nx">tile1</span><span class="p">.</span><span class="nx">id</span><span class="si">}</span><span class="s">v</span><span class="si">#{</span><span class="nx">tile2</span><span class="p">.</span><span class="nx">id</span><span class="si">}</span><span class="s">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">distance</span><span class="p">(</span><span class="nx">tile1</span><span class="p">.</span><span class="nx">s</span><span class="p">,</span> <span class="nx">tile2</span><span class="p">.</span><span class="nx">n</span><span class="p">)</span>
        <span class="nx">map</span><span class="p">[</span><span class="s">&quot;</span><span class="si">#{</span><span class="nx">tile2</span><span class="p">.</span><span class="nx">id</span><span class="si">}</span><span class="s">v</span><span class="si">#{</span><span class="nx">tile1</span><span class="p">.</span><span class="nx">id</span><span class="si">}</span><span class="s">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">distance</span><span class="p">(</span><span class="nx">tile2</span><span class="p">.</span><span class="nx">s</span><span class="p">,</span> <span class="nx">tile1</span><span class="p">.</span><span class="nx">n</span><span class="p">)</span>
    <span class="k">return</span> <span class="nx">map</span>
  <span class="nb">window</span><span class="p">.</span><span class="nv">map = map = </span><span class="nx">buildMap</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>Get the resulting coordinate moving N/S/E/W from an existing coordinate.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nb">window</span><span class="p">.</span><span class="nv">move = move = </span><span class="nf">(coord, direction) -&gt;</span>
    <span class="nv">bits = </span><span class="nb">String</span><span class="p">(</span><span class="nx">coord</span><span class="p">).</span><span class="nx">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span>
    <span class="k">switch</span> <span class="nx">direction</span>
      <span class="k">when</span> <span class="s">&quot;n&quot;</span> <span class="k">then</span> <span class="o">--</span><span class="nx">bits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
      <span class="k">when</span> <span class="s">&quot;s&quot;</span> <span class="k">then</span> <span class="o">++</span><span class="nx">bits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
      <span class="k">when</span> <span class="s">&quot;e&quot;</span> <span class="k">then</span> <span class="o">++</span><span class="nx">bits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="k">when</span> <span class="s">&quot;w&quot;</span> <span class="k">then</span> <span class="o">--</span><span class="nx">bits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="nx">bits</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>Build the converse of the <code>reverseGrid</code> so we can look up where a tile was
placed. Not very efficient than the code I used to have, but made things
more readable. Somewhere a garbage collector is crying.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">buildReverseResultGrid = </span><span class="nf">(input) -&gt;</span>
    <span class="nv">output = </span><span class="p">{}</span>
    <span class="k">for</span> <span class="nx">own</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">value</span> <span class="k">of</span> <span class="nx">input</span>
      <span class="nx">output</span><span class="p">[</span><span class="nx">value</span><span class="p">]</span> <span class="o">=</span> <span class="nx">key</span>
    <span class="k">return</span> <span class="nx">output</span>

  <span class="nv">resultGrid = </span><span class="p">{}</span>
  <span class="nv">reverseResultGrid = </span><span class="p">{}</span>
  <span class="nv">placedTiles = </span><span class="p">[]</span>

  <span class="nv">_inner_iteration_count = </span><span class="mi">0</span>
  <span class="nv">_inner = </span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>Find the closest match. As more tiles get placed, the regular expression
gets more complex, and the first time through the loop, it is unnecessary.
It is important to this algorithm that we only find matches to already
places tiles because trying to handle simultanous disjoint sets would
suuuuuuuck.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">matchDistance = </span><span class="mi">9999</span>
    <span class="nv">match = </span><span class="s">&quot;&quot;</span>
    <span class="nv">mapFilterRe = </span><span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s">&quot;(</span><span class="si">#{</span><span class="nx">placedTiles</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s">&quot;)|(&quot;</span><span class="p">)</span><span class="si">}</span><span class="s">)&quot;</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\./g</span><span class="p">,</span> <span class="s">&quot;\\.&quot;</span><span class="p">))</span>
    <span class="k">for</span> <span class="nx">own</span> <span class="nx">testMatch</span><span class="p">,</span> <span class="nx">testMatchDistance</span> <span class="k">of</span> <span class="nx">map</span>
      <span class="k">if</span> <span class="nx">mapFilterRe</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">testMatch</span><span class="p">)</span> <span class="o">and</span> <span class="nx">testMatchDistance</span> <span class="o">&lt;</span> <span class="nx">matchDistance</span>
        <span class="nv">matchDistance = </span><span class="nx">testMatchDistance</span>
        <span class="nv">match = </span><span class="nx">testMatch</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="s">&quot;step </span><span class="si">#{</span><span class="o">++</span><span class="nx">_inner_iteration_count</span><span class="si">}</span><span class="s"> match:&quot;</span><span class="p">,</span> <span class="nx">match</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Place the matching tile, <code>match</code> (two tiles the first time).</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">matchPair = </span><span class="nx">match</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="sr">/[vh]/</span><span class="p">)</span>
    <span class="nv">matchPairOrientation = </span><span class="k">if</span> <span class="nx">match</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s">&#39;v&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span> <span class="k">then</span> <span class="s">&quot;v&quot;</span> <span class="k">else</span> <span class="s">&quot;h&quot;</span>
    <span class="k">if</span> <span class="o">!</span><span class="nx">placedTiles</span><span class="p">.</span><span class="nx">length</span>  <span class="c1"># this is our first time through the loop</span>
      <span class="nv">origin = </span><span class="s">&#39;0.0&#39;</span>
      <span class="nx">resultGrid</span><span class="p">[</span><span class="nx">origin</span><span class="p">]</span> <span class="o">=</span> <span class="nx">matchPair</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="nv">reverseResultGrid = </span><span class="nx">buildReverseResultGrid</span><span class="p">(</span><span class="nx">resultGrid</span><span class="p">)</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="s">&quot;map.length&quot;</span><span class="p">,</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">getOwnPropertyNames</span><span class="p">(</span><span class="nx">map</span><span class="p">).</span><span class="nx">length</span>
    <span class="nv">a = </span><span class="nx">matchPair</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="nv">b = </span><span class="nx">matchPair</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="nv">origin = </span><span class="nx">reverseResultGrid</span><span class="p">[</span><span class="nx">a</span><span class="p">]</span>
      <span class="nv">toBePlaced = </span><span class="nx">b</span>
      <span class="k">if</span> <span class="nx">matchPairOrientation</span> <span class="o">==</span> <span class="s">&quot;v&quot;</span>
        <span class="nx">resultGrid</span><span class="p">[</span><span class="nx">move</span><span class="p">(</span><span class="nx">origin</span><span class="p">,</span> <span class="s">&quot;s&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="nx">b</span>
      <span class="k">else</span>
        <span class="nx">resultGrid</span><span class="p">[</span><span class="nx">move</span><span class="p">(</span><span class="nx">origin</span><span class="p">,</span> <span class="s">&quot;e&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="nx">b</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nv">origin = </span><span class="nx">reverseResultGrid</span><span class="p">[</span><span class="nx">b</span><span class="p">]</span>
      <span class="nv">toBePlaced = </span><span class="nx">a</span>
      <span class="k">if</span> <span class="nx">matchPairOrientation</span> <span class="o">==</span> <span class="s">&quot;v&quot;</span>
        <span class="nx">resultGrid</span><span class="p">[</span><span class="nx">move</span><span class="p">(</span><span class="nx">origin</span><span class="p">,</span> <span class="s">&quot;n&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="nx">a</span>
      <span class="k">else</span>
        <span class="nx">resultGrid</span><span class="p">[</span><span class="nx">move</span><span class="p">(</span><span class="nx">origin</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="nx">a</span>
    <span class="k">else</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">error</span> <span class="s">&quot;oops, incorrectly matched a disjoint tile&quot;</span>
      <span class="k">return</span> <span class="nx">resultGrid</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>Cleanup and setup for the next run through the loop.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="nb">window</span><span class="p">.</span><span class="nv">resultGrid = </span><span class="nx">resultGrid</span>
    <span class="nb">window</span><span class="p">.</span><span class="nv">reverseResultGrid = reverseResultGrid = </span><span class="nx">buildReverseResultGrid</span><span class="p">(</span><span class="nx">resultGrid</span><span class="p">)</span>
    <span class="nv">placedTiles = </span><span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">reverseResultGrid</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>Eliminate all invalid matches.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">for</span> <span class="nx">own</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">value</span> <span class="k">of</span> <span class="nx">map</span>
      <span class="k">if</span> <span class="nx">key</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="s">&quot;</span><span class="si">#{</span><span class="nx">a</span><span class="si">}#{</span><span class="nx">matchPairOrientation</span><span class="si">}</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="k">delete</span> <span class="nx">map</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span>
        <span class="k">continue</span>
      <span class="k">if</span> <span class="nx">key</span><span class="p">.</span><span class="nx">endsWith</span><span class="p">(</span><span class="s">&quot;</span><span class="si">#{</span><span class="nx">matchPairOrientation</span><span class="si">}#{</span><span class="nx">b</span><span class="si">}</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="k">delete</span> <span class="nx">map</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span>
        <span class="k">continue</span>
      <span class="nv">matchPair = </span><span class="nx">key</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="sr">/[vh]/</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>remove already placed tiles</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="nx">matchPair</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">in</span> <span class="nx">placedTiles</span> <span class="o">and</span> <span class="nx">matchPair</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">in</span> <span class="nx">placedTiles</span>
        <span class="k">delete</span> <span class="nx">map</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span>
        <span class="k">continue</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>Check the other orientation of <code>toBePlaced</code>.
TODO this block could be executed smarter</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">resultGrid</span><span class="p">[</span><span class="nx">move</span><span class="p">(</span><span class="nx">reverseResultGrid</span><span class="p">[</span><span class="nx">toBePlaced</span><span class="p">],</span> <span class="s">&quot;e&quot;</span><span class="p">)]</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="s">&quot;!!!Delete east of </span><span class="si">#{</span><span class="nx">toBePlaced</span><span class="si">}</span><span class="s">&quot;</span>
      <span class="k">for</span> <span class="nx">own</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">value</span> <span class="k">of</span> <span class="nx">map</span>
        <span class="k">if</span> <span class="nx">key</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="s">&quot;</span><span class="si">#{</span><span class="nx">toBePlaced</span><span class="si">}</span><span class="s">h&quot;</span><span class="p">)</span>
          <span class="k">delete</span> <span class="nx">map</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span>
          <span class="k">continue</span>
    <span class="k">if</span> <span class="nx">resultGrid</span><span class="p">[</span><span class="nx">move</span><span class="p">(</span><span class="nx">reverseResultGrid</span><span class="p">[</span><span class="nx">toBePlaced</span><span class="p">],</span> <span class="s">&quot;s&quot;</span><span class="p">)]</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="s">&quot;!!!Delete south of </span><span class="si">#{</span><span class="nx">toBePlaced</span><span class="si">}</span><span class="s">&quot;</span>
      <span class="k">for</span> <span class="nx">own</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">value</span> <span class="k">of</span> <span class="nx">map</span>
        <span class="k">if</span> <span class="nx">key</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="s">&quot;</span><span class="si">#{</span><span class="nx">toBePlaced</span><span class="si">}</span><span class="s">v&quot;</span><span class="p">)</span>
          <span class="k">delete</span> <span class="nx">map</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span>
          <span class="k">continue</span>
    <span class="k">if</span> <span class="nx">resultGrid</span><span class="p">[</span><span class="nx">move</span><span class="p">(</span><span class="nx">reverseResultGrid</span><span class="p">[</span><span class="nx">toBePlaced</span><span class="p">],</span> <span class="s">&quot;n&quot;</span><span class="p">)]</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="s">&quot;!!!Delete north of </span><span class="si">#{</span><span class="nx">toBePlaced</span><span class="si">}</span><span class="s">&quot;</span>
      <span class="k">for</span> <span class="nx">own</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">value</span> <span class="k">of</span> <span class="nx">map</span>
        <span class="k">if</span> <span class="nx">key</span><span class="p">.</span><span class="nx">endsWith</span><span class="p">(</span><span class="s">&quot;v</span><span class="si">#{</span><span class="nx">toBePlaced</span><span class="si">}</span><span class="s">&quot;</span><span class="p">)</span>
          <span class="k">delete</span> <span class="nx">map</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span>
          <span class="k">continue</span>
    <span class="k">if</span> <span class="nx">resultGrid</span><span class="p">[</span><span class="nx">move</span><span class="p">(</span><span class="nx">reverseResultGrid</span><span class="p">[</span><span class="nx">toBePlaced</span><span class="p">],</span> <span class="s">&quot;w&quot;</span><span class="p">)]</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="s">&quot;!!!Delete west of </span><span class="si">#{</span><span class="nx">toBePlaced</span><span class="si">}</span><span class="s">&quot;</span>
      <span class="k">for</span> <span class="nx">own</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">value</span> <span class="k">of</span> <span class="nx">map</span>
        <span class="k">if</span> <span class="nx">key</span><span class="p">.</span><span class="nx">endsWith</span><span class="p">(</span><span class="s">&quot;h</span><span class="si">#{</span><span class="nx">toBePlaced</span><span class="si">}</span><span class="s">&quot;</span><span class="p">)</span>
          <span class="k">delete</span> <span class="nx">map</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span>
          <span class="k">continue</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="s">&quot;map.length&quot;</span><span class="p">,</span>
                <span class="nb">Object</span><span class="p">.</span><span class="nx">getOwnPropertyNames</span><span class="p">(</span><span class="nx">map</span><span class="p">).</span><span class="nx">length</span><span class="p">,</span>
                <span class="nx">copy</span><span class="p">(</span><span class="nx">map</span><span class="p">),</span>
    <span class="k">if</span> <span class="nx">delay</span>
      <span class="nx">drawGrid</span><span class="p">(</span><span class="nx">resultGrid</span><span class="p">)</span>  <span class="c1"># TODO use pubsub instead of just calling this</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>for stepNumber in [1..11]</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">for</span> <span class="nx">stepNumber</span> <span class="k">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">..(</span><span class="nx">n_slices</span> <span class="o">*</span> <span class="nx">n_slices</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)]</span>
    <span class="k">if</span> <span class="nx">delay</span>
      <span class="nx">setTimeout</span><span class="p">(</span><span class="nx">_inner</span><span class="p">,</span> <span class="nx">stepNumber</span> <span class="o">*</span> <span class="nx">_options</span><span class="p">.</span><span class="nx">draw_delay</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="nx">_inner</span><span class="p">()</span>

  <span class="k">return</span> <span class="nx">resultGrid</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 